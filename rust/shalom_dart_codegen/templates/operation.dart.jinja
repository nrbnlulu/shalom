{% macro base_object_impl(typename, selections, operation_name) %}
class {{typename}} {
  {% for selection in selections %}
  {% if selection.kind == "Object" %}
  final {{operation_name}}{{selection.selection_name|capitalize}}? {{selection.selection_name}};
  {% else %}
  final {{type_name_for_selection(selection)}} {{selection.selection_name}};
  {% endif %}
  {% endfor %}

  {{typename}}({
    {% for selection in selections %}
    {% if not selection.is_optional %}required {% endif %}this.{{selection.selection_name}},
    {% endfor %}
  });

  factory {{typename}}.fromJson(Map<String, dynamic> json) => {{typename}}(
    {% for selection in selections %}
    {{selection.selection_name}}: {% if selection.kind == "Object" %}
      json['{{selection.selection_name}}'] != null 
        ? {{operation_name}}{{selection.selection_name|capitalize}}.fromJson(json['{{selection.selection_name}}'] as Map<String, dynamic>)
        : null
    {% else %}
      json['{{selection.selection_name}}'] as {{type_name_for_selection(selection)}}
    {% endif %},
    {% endfor %}
  );

  {{typename}} updateWithJson(Map<String, dynamic> data) {
    return {{typename}}(
      {% for selection in selections %}
      {{selection.selection_name}}: {% if selection.kind == "Object" %}
        data.containsKey('{{selection.selection_name}}') 
          ? (data['{{selection.selection_name}}'] != null 
              ? {{operation_name}}{{selection.selection_name|capitalize}}.fromJson(data['{{selection.selection_name}}'] as Map<String, dynamic>)
              : null)
          : this.{{selection.selection_name}}
      {% else %}
        data.containsKey('{{selection.selection_name}}') 
          ? data['{{selection.selection_name}}'] as {{type_name_for_selection(selection)}}
          : this.{{selection.selection_name}}
      {% endif %},
      {% endfor %}
    );
  }

  Map<String, dynamic> toJson() => {
    {% for selection in selections %}
    '{{selection.selection_name}}': {% if selection.kind == "Object" %}
      {{selection.selection_name}}?.toJson()
    {% else %}
      {{selection.selection_name}}
    {% endif %},
    {% endfor %}
  };

  @override
  bool operator ==(Object other) =>
      identical(this, other) ||
      (other is {{typename}} &&
          {% for selection in selections %}
          other.{{selection.selection_name}} == {{selection.selection_name}} &&
          {% endfor %}
          true);

  @override
  int get hashCode => Object.hashAll([
    {% for selection in selections %}
    {{selection.selection_name}},
    {% endfor %}
  ]);
}
{% endmacro %}

{% set operation_name = operation.context.root_type.selection_name %}

{{base_object_impl('Request' ~ operation_name, operation.context.root_type.selections, operation_name)}}

{% macro base_object_impl_recursive(selections) %}
    {% for selection in selections if selection.kind == "Object" %}
        {{ base_object_impl(operation_name ~ selection.selection_name|capitalize, selection.selections, operation_name)}}
        {{ base_object_impl_recursive(selection.selections) }}
    {% endfor %}
{% endmacro %}

{{ base_object_impl_recursive(operation.context.root_type.selections) }}