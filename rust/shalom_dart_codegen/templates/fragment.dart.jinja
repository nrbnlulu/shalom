{% include "macros" %}

{% set fragment_name = context.fragment.name %}
{% set typedefs = context.fragment.typedefs %}
{% set op_variables = None %}
{% set op_variables_exist = false %}

{% include "selection_macros" %}

// ignore_for_file: constant_identifier_names, non_constant_identifier_names, unused_import, camel_case_types, unnecessary_this, unnecessary_non_null_assertion, depend_on_referenced_packages, empty_statements, annotate_overrides, no_leading_underscores_for_local_identifiers, unnecessary_cast, camel_case_extensions
// GENERATED CODE - DO NOT MODIFY BY HAND
// Fragment: {{fragment_name}}

import "{{ context.schema_import_path }}";
import 'package:shalom_core/shalom_core.dart' as shalom_core;
import 'package:collection/collection.dart';
import 'package:meta/meta.dart' show experimental;
{{ custom_scalar_imports_macro(context.custom_scalar_imports) }}

{% for import_path in generate_fragment_imports(context.fragment_file_path) -%}
import '{{ import_path }}';
{% endfor %}

// Generate abstract fragment class
abstract class {{ fragment_name }}{{ implements_used_fragments(context.fragment.root_type.used_fragments) }} {
    {% for field in frag_root_shared_selections() if field.name != "__typename" -%}
        {{ type_name_for_selection(field) }} get {{ field.name }};
    {% endfor %}

  static const shalom_core.FromCache<{{ fragment_name }}> cacheBuilder =
      {{ fragment_name }}FromCache();

  Map<String, dynamic> toJson();

}

class {{ fragment_name }}Impl implements {{ fragment_name }} {
  {{ selection_object_impl(fragment_name ~ "Impl", context.fragment.root_type, is_root_selection=false, full_name=context.fragment.root_type.path_name, shared_selections=frag_root_shared_selections()) }}
}

class {{ fragment_name }}FromCache
    implements shalom_core.FromCache<{{ fragment_name }}> {
  const {{ fragment_name }}FromCache();

  @override
  String get subscriberGlobalID => '{{ fragment_name }}';

  @override
  {{ fragment_name }} fromCache(shalom_core.JsonObject data) {
    return {{ fragment_name }}Impl.fromJson(data);
  }
}

// ------------ START OBJECT DEFINITIONS -------------
{% for name, obj in typedefs.objects | items -%}
    {{ selection_object_definition(obj) }}
{% endfor %}
// ------------ END OBJECT DEFINITIONS -------------


// ------------ START UNION DEFINITIONS -------------

{% for union_full_name, union_selection in typedefs.unions | items -%}
    {% set concretes = multitype_selection_resolved_concretes(union_full_name) -%}
    {# generate sealed classes #}
    {{ multi_type_selection_definition(union_full_name, union_selection, concretes) }}

    {# generate subsets #}
    {% for concrete_subset in concretes -%}
        class {{ concrete_subset.path_name }} extends {{ union_full_name }} {{implements_used_fragments(concrete_subset.used_fragments)}} {
            {{ selection_object_impl(concrete_subset.path_name, concrete_subset, is_root_selection=false, full_name=concrete_subset.path_name, is_multi_type_member=true, shared_selections=concrete_subset.selections) }}
        }
    {% endfor %}
{% endfor %}

// ------------ END UNION DEFINITIONS -------------

// ------------ INTERFACE DEFINITIONS -------------

{% for iface_path_name, iface_selection in typedefs.interfaces | items %}
    {% set concretes = multitype_selection_resolved_concretes(iface_path_name) -%}
    {# generate sealed classes #}
    {{ multi_type_selection_definition(iface_path_name, iface_selection, concretes) }}

    {# generate subsets #}
    {% set concretes = multitype_selection_resolved_concretes(iface_path_name) -%}
    {% for concrete_subset in concretes -%}
        class {{ concrete_subset.path_name }} extends {{ iface_path_name }} {{implements_used_fragments(concrete_subset.used_fragments)}} {
            {{ selection_object_impl(concrete_subset.path_name, concrete_subset, is_root_selection=false, full_name=concrete_subset.path_name, is_multi_type_member=true, shared_selections=concrete_subset.selections) }}
        }
    {% endfor %}
{% endfor %}

// ------------ END INTERFACE DEFINITIONS -------------

{{ generate_multi_type_list_extensions(multi_type_list_selections) }}
